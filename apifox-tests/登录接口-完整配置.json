{
  "name": "5. 用户登录",
  "request": {
    "method": "POST",
    "url": "{{baseUrl}}/zhiyan/auth/login",
    "headers": [
      {
        "key": "Content-Type",
        "value": "application/json"
      }
    ],
    "body": {
      "mode": "raw",
      "raw": "{\n  \"email\": \"768331153@qq.com\",\n  \"password\": \"123456\",\n  \"rememberMe\": false\n}"
    }
  },
  "scripts": {
    "postScript": {
      "type": "text/javascript",
      "exec": [
        "// 自动提取并保存Token到环境变量",
        "",
        "if (pm.response.code === 200) {",
        "    try {",
        "        var jsonData = pm.response.json();",
        "        ",
        "        if (jsonData.code === 200 && jsonData.data && jsonData.data.accessToken) {",
        "            // 保存accessToken",
        "            var token = jsonData.data.accessToken;",
        "            pm.environment.set('accessToken', token);",
        "            ",
        "            // 保存用户信息",
        "            if (jsonData.data.user) {",
        "                pm.environment.set('userId', jsonData.data.user.id);",
        "                pm.environment.set('userName', jsonData.data.user.name);",
        "                pm.environment.set('userEmail', jsonData.data.user.email);",
        "            }",
        "            ",
        "            // 保存refreshToken",
        "            if (jsonData.data.refreshToken) {",
        "                pm.environment.set('refreshToken', jsonData.data.refreshToken);",
        "            }",
        "            ",
        "            console.log('✅ 登录成功！Token已自动保存');",
        "            console.log('Token:', token.substring(0, 30) + '...');",
        "            console.log('用户:', jsonData.data.user.name);",
        "        } else {",
        "            console.error('❌ 登录失败:', jsonData.msg || '未知错误');",
        "        }",
        "    } catch (e) {",
        "        console.error('❌ 处理响应异常:', e);",
        "    }",
        "} else {",
        "    console.error('❌ HTTP请求失败，状态码:', pm.response.code);",
        "}"
      ]
    }
  },
  "tests": [
    {
      "name": "状态码为200",
      "script": "pm.test('Status code is 200', function() { pm.response.to.have.status(200); });"
    },
    {
      "name": "返回包含token",
      "script": "pm.test('Response has token', function() { var jsonData = pm.response.json(); pm.expect(jsonData.data).to.have.property('accessToken'); });"
    }
  ]
}

