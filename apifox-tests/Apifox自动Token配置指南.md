# Apifox è‡ªåŠ¨Tokené…ç½®å®Œæ•´æŒ‡å—

## ğŸ¯ ç›®æ ‡
å®ç°ï¼šç™»å½•ä¸€æ¬¡ â†’ è‡ªåŠ¨ä¿å­˜Token â†’ åç»­è¯·æ±‚è‡ªåŠ¨æºå¸¦Token

---

## ğŸ“‹ é…ç½®æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

1. ç‚¹å‡»Apifoxå·¦ä¸Šè§’çš„ **ç¯å¢ƒ** å›¾æ ‡
2. é€‰æ‹©æˆ–æ–°å»ºç¯å¢ƒï¼ˆå¦‚"æœ¬åœ°å¼€å‘ç¯å¢ƒ"ï¼‰
3. æ·»åŠ ä»¥ä¸‹å˜é‡ï¼š

| å˜é‡å | åˆå§‹å€¼ | è¯´æ˜ |
|--------|--------|------|
| baseUrl | http://localhost:8080 | æœåŠ¡åŸºç¡€URL |
| authBaseUrl | http://localhost:8091 | è®¤è¯æœåŠ¡URLï¼ˆå¦‚æœä¸åŒç«¯å£ï¼‰ |
| accessToken | (ç©º) | è®¿é—®ä»¤ç‰Œï¼ˆç™»å½•åè‡ªåŠ¨å¡«å……ï¼‰ |
| refreshToken | (ç©º) | åˆ·æ–°ä»¤ç‰Œï¼ˆç™»å½•åè‡ªåŠ¨å¡«å……ï¼‰ |
| userId | (ç©º) | ç”¨æˆ·IDï¼ˆç™»å½•åè‡ªåŠ¨å¡«å……ï¼‰ |
| projectId | 1 | æµ‹è¯•ç”¨é¡¹ç›®ID |
| creatorId | 1 | æµ‹è¯•ç”¨åˆ›å»ºè€…ID |

**æ³¨æ„**ï¼šaccessTokenåˆå§‹å€¼ç•™ç©ºå³å¯ï¼Œç™»å½•åä¼šè‡ªåŠ¨å¡«å……ï¼

---

### ç¬¬äºŒæ­¥ï¼šé…ç½®ç™»å½•æ¥å£

#### 1. åŸºæœ¬ä¿¡æ¯
- **åç§°**ï¼šç”¨æˆ·ç™»å½•
- **æ–¹æ³•**ï¼šPOST
- **URL**ï¼š`{{authBaseUrl}}/zhiyan/auth/login` æˆ– `http://localhost:8091/zhiyan/auth/login`

#### 2. Headers
```
Content-Type: application/json
```

#### 3. Bodyï¼ˆé€‰æ‹©raw â†’ JSONï¼‰
```json
{
  "email": "768331153@qq.com",
  "password": "123456",
  "rememberMe": false
}
```

#### 4. åç½®è„šæœ¬ï¼ˆé‡ç‚¹ï¼ï¼‰

ç‚¹å‡» **"åç½®æ“ä½œ"** æ ‡ç­¾é¡µï¼Œé€‰æ‹© **"è„šæœ¬"**ï¼Œè¾“å…¥ï¼š

```javascript
// ========== è‡ªåŠ¨ä¿å­˜Tokenåˆ°ç¯å¢ƒå˜é‡ ==========

if (pm.response.code === 200) {
    try {
        var jsonData = pm.response.json();
        
        // æ£€æŸ¥ä¸šåŠ¡çŠ¶æ€ç 
        if (jsonData.code === 200 && jsonData.data) {
            
            // ä¿å­˜accessToken
            if (jsonData.data.accessToken) {
                pm.environment.set("accessToken", jsonData.data.accessToken);
                console.log("âœ… AccessTokenå·²ä¿å­˜");
            }
            
            // ä¿å­˜refreshToken
            if (jsonData.data.refreshToken) {
                pm.environment.set("refreshToken", jsonData.data.refreshToken);
                console.log("âœ… RefreshTokenå·²ä¿å­˜");
            }
            
            // ä¿å­˜ç”¨æˆ·ä¿¡æ¯
            if (jsonData.data.user) {
                pm.environment.set("userId", jsonData.data.user.id);
                pm.environment.set("userName", jsonData.data.user.name);
                pm.environment.set("userEmail", jsonData.data.user.email);
                console.log("âœ… ç”¨æˆ·ä¿¡æ¯å·²ä¿å­˜: " + jsonData.data.user.name);
            }
            
            console.log("ğŸ‰ ç™»å½•æˆåŠŸï¼æ‰€æœ‰ä¿¡æ¯å·²è‡ªåŠ¨ä¿å­˜åˆ°ç¯å¢ƒå˜é‡");
            
        } else {
            console.error("âŒ ç™»å½•å¤±è´¥: " + (jsonData.msg || "æœªçŸ¥é”™è¯¯"));
        }
    } catch (e) {
        console.error("âŒ è„šæœ¬æ‰§è¡Œå¤±è´¥:", e.message);
    }
} else {
    console.error("âŒ HTTPè¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç :", pm.response.code);
}
```

#### 5. æµ‹è¯•ç”¨ä¾‹ï¼ˆå¯é€‰ï¼‰

åœ¨ **"æµ‹è¯•"** æ ‡ç­¾é¡µæ·»åŠ ï¼š

```javascript
// æµ‹è¯•1ï¼šæ£€æŸ¥HTTPçŠ¶æ€ç 
pm.test("HTTPçŠ¶æ€ç ä¸º200", function () {
    pm.response.to.have.status(200);
});

// æµ‹è¯•2ï¼šæ£€æŸ¥ä¸šåŠ¡çŠ¶æ€ç 
pm.test("ç™»å½•æˆåŠŸ", function () {
    var jsonData = pm.response.json();
    pm.expect(jsonData.code).to.eql(200);
});

// æµ‹è¯•3ï¼šæ£€æŸ¥è¿”å›äº†Token
pm.test("è¿”å›äº†AccessToken", function () {
    var jsonData = pm.response.json();
    pm.expect(jsonData.data).to.have.property('accessToken');
    pm.expect(jsonData.data.accessToken).to.be.a('string');
});
```

---

### ç¬¬ä¸‰æ­¥ï¼šåœ¨å…¶ä»–æ¥å£ä¸­ä½¿ç”¨Token

#### æ–¹æ³•Aï¼šå•ä¸ªæ¥å£é…ç½®ï¼ˆé€‚åˆå°‘é‡æ¥å£ï¼‰

å¯¹æ¯ä¸ªéœ€è¦è®¤è¯çš„æ¥å£ï¼š

1. æ‰“å¼€æ¥å£ï¼ˆå¦‚"1. åˆ›å»ºé¡¹ç›®"ï¼‰
2. ç‚¹å‡» **Headers** æ ‡ç­¾
3. æ·»åŠ Headerï¼š
   - **Key**: `Authorization`
   - **Value**: `Bearer {{accessToken}}`
   - âœ… å‹¾é€‰å¯ç”¨

**ç¤ºä¾‹**ï¼š
```
Authorization: Bearer {{accessToken}}
```

#### æ–¹æ³•Bï¼šå…¨å±€é…ç½®ï¼ˆæ¨èï¼Œé€‚åˆå¤§é‡æ¥å£ï¼‰

1. ç‚¹å‡»ç¯å¢ƒè®¾ç½®
2. æ‰¾åˆ° **"å…¬å…±Header"** æˆ– **"å…¨å±€å‚æ•°"** é€‰é¡¹
3. æ·»åŠ ï¼š
   - **å‚æ•°å**: `Authorization`
   - **å‚æ•°å€¼**: `Bearer {{accessToken}}`
   - **åº”ç”¨èŒƒå›´**: é€‰æ‹©éœ€è¦çš„æ¥å£åˆ†ç»„

è¿™æ ·æ‰€æœ‰æ¥å£éƒ½ä¼šè‡ªåŠ¨æºå¸¦è¿™ä¸ªHeaderï¼

---

## ğŸ§ª æµ‹è¯•æµç¨‹

### å®Œæ•´æµ‹è¯•æ­¥éª¤ï¼š

#### 1. ç¬¬ä¸€æ¬¡ç™»å½•
```
æ‰“å¼€"ç”¨æˆ·ç™»å½•"æ¥å£
â†’ ç‚¹å‡»"å‘é€"
â†’ æŸ¥çœ‹å“åº”ï¼ˆåº”è¯¥æˆåŠŸï¼‰
â†’ æŸ¥çœ‹æ§åˆ¶å°ï¼ˆConsoleï¼‰ï¼Œåº”è¯¥æ˜¾ç¤ºï¼š
   âœ… AccessTokenå·²ä¿å­˜
   âœ… RefreshTokenå·²ä¿å­˜
   âœ… ç”¨æˆ·ä¿¡æ¯å·²ä¿å­˜: å¼ ä¸‰
   ğŸ‰ ç™»å½•æˆåŠŸï¼æ‰€æœ‰ä¿¡æ¯å·²è‡ªåŠ¨ä¿å­˜åˆ°ç¯å¢ƒå˜é‡
```

#### 2. éªŒè¯Tokenå·²ä¿å­˜
```
ç‚¹å‡»ç¯å¢ƒå›¾æ ‡
â†’ æŸ¥çœ‹å½“å‰ç¯å¢ƒçš„å˜é‡
â†’ ç¡®è®¤ accessToken å·²ç»æœ‰å€¼ï¼ˆä¸€é•¿ä¸²å­—ç¬¦ä¸²ï¼‰
```

#### 3. æµ‹è¯•å…¶ä»–æ¥å£
```
æ‰“å¼€ä»»æ„éœ€è¦è®¤è¯çš„æ¥å£ï¼ˆå¦‚"è·å–æˆ‘åˆ›å»ºçš„é¡¹ç›®"ï¼‰
â†’ ç¡®è®¤Headersä¸­æœ‰ï¼šAuthorization: Bearer {{accessToken}}
â†’ ç‚¹å‡»"å‘é€"
â†’ åº”è¯¥æˆåŠŸè¿”å›æ•°æ®ï¼ˆå› ä¸ºå·²ç»è‡ªåŠ¨æºå¸¦äº†Tokenï¼‰
```

#### 4. Tokenè¿‡æœŸåé‡æ–°ç™»å½•
```
å¦‚æœæ¥å£è¿”å›401ï¼ˆæœªæˆæƒï¼‰
â†’ é‡æ–°è°ƒç”¨"ç”¨æˆ·ç™»å½•"æ¥å£
â†’ Tokenä¼šè‡ªåŠ¨æ›´æ–°
â†’ å†æ¬¡è°ƒç”¨å…¶ä»–æ¥å£å³å¯
```

---

## ğŸ“Š ç¯å¢ƒå˜é‡å¼•ç”¨è¯­æ³•

åœ¨Apifoxä¸­ï¼Œä½¿ç”¨åŒèŠ±æ‹¬å·å¼•ç”¨ç¯å¢ƒå˜é‡ï¼š

```
{{variableName}}
```

**ç¤ºä¾‹**ï¼š

```javascript
// URLä¸­ä½¿ç”¨
{{baseUrl}}/api/projects

// Headerä¸­ä½¿ç”¨
Authorization: Bearer {{accessToken}}

// Bodyä¸­ä½¿ç”¨ï¼ˆJSONï¼‰
{
  "userId": {{userId}},
  "email": "{{userEmail}}"
}

// Queryå‚æ•°ä¸­ä½¿ç”¨
?projectId={{projectId}}
```

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: ç™»å½•åTokenæ²¡æœ‰è‡ªåŠ¨ä¿å­˜ï¼Ÿ

**æ£€æŸ¥æ¸…å•**ï¼š
1. âœ… ç¡®è®¤æ·»åŠ äº†åç½®è„šæœ¬
2. âœ… æŸ¥çœ‹æ§åˆ¶å°ï¼ˆConsoleï¼‰æ˜¯å¦æœ‰é”™è¯¯
3. âœ… ç¡®è®¤å“åº”JSONç»“æ„æ­£ç¡®
4. âœ… æ£€æŸ¥ç¯å¢ƒå˜é‡åæ‹¼å†™æ˜¯å¦ä¸€è‡´

**è°ƒè¯•æ–¹æ³•**ï¼š
```javascript
// åœ¨åç½®è„šæœ¬ä¸­æ·»åŠ è°ƒè¯•æ—¥å¿—
console.log("å“åº”æ•°æ®:", JSON.stringify(pm.response.json(), null, 2));
```

### Q2: å…¶ä»–æ¥å£æç¤º401æœªæˆæƒï¼Ÿ

**æ£€æŸ¥æ¸…å•**ï¼š
1. âœ… ç¡®è®¤Headerä¸­æ·»åŠ äº† `Authorization: Bearer {{accessToken}}`
2. âœ… ç¡®è®¤ç¯å¢ƒå˜é‡ `accessToken` æœ‰å€¼
3. âœ… ç¡®è®¤Tokenæ ¼å¼æ­£ç¡®ï¼ˆBearer + ç©ºæ ¼ + tokenï¼‰
4. âœ… ç¡®è®¤Tokenæœªè¿‡æœŸï¼ˆå¯ä»¥é‡æ–°ç™»å½•ï¼‰

### Q3: Tokenè¿‡æœŸäº†æ€ä¹ˆåŠï¼Ÿ

**è§£å†³æ–¹æ³•**ï¼š
- é‡æ–°è°ƒç”¨ç™»å½•æ¥å£ï¼ŒTokenä¼šè‡ªåŠ¨æ›´æ–°
- æˆ–è€…ä½¿ç”¨åˆ·æ–°Tokenæ¥å£ï¼ˆå¦‚æœæœ‰ï¼‰

### Q4: å¦‚ä½•æŸ¥çœ‹å½“å‰Tokençš„å€¼ï¼Ÿ

**æ–¹æ³•1**ï¼šæŸ¥çœ‹ç¯å¢ƒå˜é‡
```
ç‚¹å‡»ç¯å¢ƒå›¾æ ‡ â†’ æŸ¥çœ‹å½“å‰ç¯å¢ƒ â†’ æ‰¾åˆ°accessToken
```

**æ–¹æ³•2**ï¼šåœ¨è„šæœ¬ä¸­æ‰“å°
```javascript
console.log("å½“å‰Token:", pm.environment.get("accessToken"));
```

---

## ğŸ’¡ é«˜çº§æŠ€å·§

### æŠ€å·§1ï¼šè‡ªåŠ¨åˆ¤æ–­Tokenæ˜¯å¦å³å°†è¿‡æœŸ

åœ¨éœ€è¦è®¤è¯çš„æ¥å£çš„ **å‰ç½®è„šæœ¬** ä¸­æ·»åŠ ï¼š

```javascript
// æ£€æŸ¥Tokenæ˜¯å¦å­˜åœ¨
var token = pm.environment.get("accessToken");
if (!token) {
    console.warn("âš ï¸ æœªæ‰¾åˆ°Tokenï¼Œè¯·å…ˆç™»å½•");
}
```

### æŠ€å·§2ï¼šç»Ÿä¸€é”™è¯¯å¤„ç†

åœ¨ç™»å½•æ¥å£çš„åç½®è„šæœ¬ä¸­æ·»åŠ ï¼š

```javascript
// ç»Ÿä¸€é”™è¯¯å¤„ç†
if (pm.response.code !== 200) {
    console.error("âŒ è¯·æ±‚å¤±è´¥");
    console.error("çŠ¶æ€ç :", pm.response.code);
    console.error("å“åº”:", pm.response.text());
}
```

### æŠ€å·§3ï¼šä¿å­˜å¤šä¸ªç¯å¢ƒçš„Token

ä¸ºä¸åŒç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰åˆ†åˆ«ä¿å­˜Tokenï¼š

```
ç¯å¢ƒï¼šæœ¬åœ°å¼€å‘ â†’ accessToken: xxx
ç¯å¢ƒï¼šæµ‹è¯•æœåŠ¡å™¨ â†’ accessToken: yyy
ç¯å¢ƒï¼šç”Ÿäº§ç¯å¢ƒ â†’ accessToken: zzz
```

åˆ‡æ¢ç¯å¢ƒæ—¶ï¼ŒTokenä¼šè‡ªåŠ¨åˆ‡æ¢ï¼

---

## ğŸ¯ æ¨èçš„é¡¹ç›®ç»“æ„

```
æ™ºç ”å¹³å°APIæµ‹è¯•
â”œâ”€â”€ ğŸ“ è®¤è¯æ¨¡å—
â”‚   â”œâ”€â”€ âœ… 5. ç”¨æˆ·ç™»å½• (å«åç½®è„šæœ¬)
â”‚   â”œâ”€â”€ 6. ç”¨æˆ·æ³¨å†Œ
â”‚   â””â”€â”€ 7. åˆ·æ–°Token
â”œâ”€â”€ ğŸ“ é¡¹ç›®ç®¡ç†API
â”‚   â”œâ”€â”€ 1. åˆ›å»ºé¡¹ç›® (è‡ªåŠ¨æºå¸¦Token)
â”‚   â”œâ”€â”€ 2. æ›´æ–°é¡¹ç›® (è‡ªåŠ¨æºå¸¦Token)
â”‚   â”œâ”€â”€ 3. åˆ é™¤é¡¹ç›® (è‡ªåŠ¨æºå¸¦Token)
â”‚   â””â”€â”€ ...
â””â”€â”€ ğŸ“ ç¯å¢ƒé…ç½®
    â”œâ”€â”€ æœ¬åœ°å¼€å‘ (baseUrl: localhost:8080)
    â”œâ”€â”€ æµ‹è¯•ç¯å¢ƒ (baseUrl: test.example.com)
    â””â”€â”€ ç”Ÿäº§ç¯å¢ƒ (baseUrl: api.example.com)
```

---

## âœ… é…ç½®å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] åˆ›å»ºäº†ç¯å¢ƒå¹¶æ·»åŠ äº†å¿…è¦çš„å˜é‡
- [ ] ç™»å½•æ¥å£é…ç½®äº†åç½®è„šæœ¬
- [ ] æµ‹è¯•ç™»å½•æ¥å£ï¼ŒTokenæˆåŠŸä¿å­˜
- [ ] å…¶ä»–æ¥å£æ·»åŠ äº† Authorization Header
- [ ] æµ‹è¯•è‡³å°‘ä¸€ä¸ªéœ€è¦è®¤è¯çš„æ¥å£
- [ ] äº†è§£å¦‚ä½•æŸ¥çœ‹å’Œæ›´æ–°Token

---

**ğŸ‰ é…ç½®å®Œæˆåï¼Œä½ å°±å¯ä»¥ï¼š**
1. ç™»å½•ä¸€æ¬¡
2. Tokenè‡ªåŠ¨ä¿å­˜
3. åç»­æ‰€æœ‰æ¥å£è‡ªåŠ¨æºå¸¦Token
4. Tokenè¿‡æœŸåé‡æ–°ç™»å½•å³å¯

**æ— éœ€æ¯æ¬¡æ‰‹åŠ¨å¤åˆ¶ç²˜è´´Tokenï¼** ğŸš€

