# å‰åç«¯ç«¯å£é…ç½®æ€»ç»“

## ğŸ“Š åç«¯æœåŠ¡ç«¯å£é…ç½®

| æœåŠ¡å | ç«¯å£ | é…ç½®æ–‡ä»¶ | è¯´æ˜ |
|--------|------|----------|------|
| **zhiyan-gateway** | **9006** | `zhiyan-gateway/src/main/resources/application-prod.yml` | ç½‘å…³æœåŠ¡ï¼ˆæœªä½¿ç”¨ï¼‰ |
| **zhiyan-auth** | **8091** | `zhiyan-auth/src/main/resources/application-prod.yml` | è®¤è¯æœåŠ¡ |
| **zhiyan-knowledge** | **8093** | `zhiyan-modules/zhiyan-knowledge/src/main/resources/application-prod.yml` | çŸ¥è¯†åº“æœåŠ¡ |
| **zhiyan-project** | **8095** | `zhiyan-modules/zhiyan-project/src/main/resources/application-prod.yml` | é¡¹ç›®æœåŠ¡ |
| **zhiyan-ai-coze** | **8094** | `zhiyan-ai/zhiyan-ai-coze/src/main/resources/application-prod.yml` | Coze AIæœåŠ¡ |
| **zhiyan-ai-dify** | **8097** | `zhiyan-ai/zhiyan-ai-dify/src/main/resources/application-prod.yml` | Dify AIæœåŠ¡ |

## ğŸŒ å‰ç«¯é…ç½®

| é¡¹ç›® | ç«¯å£ | é…ç½®æ–‡ä»¶ |
|------|------|----------|
| **Vueå¼€å‘æœåŠ¡å™¨** | **8001** | `zhiyan_front/vue.config.js` |

## ğŸ”„ å‰ç«¯ä»£ç†é…ç½®ï¼ˆvue.config.jsï¼‰

### æ¶æ„è¯´æ˜
å‰ç«¯**ç›´è¿åç«¯å„ä¸ªæœåŠ¡**ï¼Œ**ä¸é€šè¿‡ç½‘å…³**ã€‚

### ä»£ç†è§„åˆ™

```javascript
module.exports = {
  devServer: {
    port: 8001,
    proxy: {
      // 1. é¡¹ç›®æœåŠ¡ (8095)
      '/zhiyan/api/projects': {
        target: 'http://localhost:8095',
        pathRewrite: { '^/zhiyan': '' }
      },
      
      // 2. ç”¨æˆ·æœç´¢ (8095)
      '/zhiyan/api/users': {
        target: 'http://localhost:8095',
        pathRewrite: { '^/zhiyan': '' }
      },
      
      // 3. çŸ¥è¯†åº“æˆæœ (8093)
      '/zhiyan/achievement': {
        target: 'http://localhost:8093'
      },
      
      // 4. Coze AI (8094)
      '/zhiyan/api/coze': {
        target: 'http://localhost:8094',
        pathRewrite: { '^/zhiyan': '' }
      },
      
      // 5. Dify AI (8097)
      '/zhiyan/api/ai': {
        target: 'http://localhost:8097',
        pathRewrite: { '^/zhiyan': '' }
      },
      
      // 6. è®¤è¯æœåŠ¡ (8091)
      '/zhiyan/api/auth': {
        target: 'http://localhost:8091',
        pathRewrite: { '^/zhiyan': '' }
      },
      
      // 7. é»˜è®¤è§„åˆ™ (8091)
      '/zhiyan': {
        target: 'http://localhost:8091'
      }
    }
  }
}
```

## ğŸ“ è¯·æ±‚æµç¨‹ç¤ºä¾‹

### 1. Dify AIå¯¹è¯è¯·æ±‚

**å‰ç«¯ä»£ç ï¼š**
```javascript
// zhiyan_front/src/api/dify.js
const url = '/zhiyan/api/ai/chatflow/stream?query=ä½ å¥½'
fetch(url, { ... })
```

**è¯·æ±‚æµç¨‹ï¼š**
```
æµè§ˆå™¨(localhost:8001)
  â†“ è¯·æ±‚: /zhiyan/api/ai/chatflow/stream
Vueä»£ç†æœåŠ¡å™¨(8001)
  â†“ åŒ¹é…è§„åˆ™: /zhiyan/api/ai â†’ http://localhost:8097
  â†“ pathRewrite: ç§»é™¤ /zhiyan
  â†“ è½¬å‘: /api/ai/chatflow/stream
Dify AIæœåŠ¡(8097)
  â†“ å¤„ç†å¹¶è¿”å›æµå¼å“åº”
æµè§ˆå™¨æ¥æ”¶SSEæµ
```

### 2. é¡¹ç›®APIè¯·æ±‚

**å‰ç«¯ä»£ç ï¼š**
```javascript
// zhiyan_front/src/api/project.js
const url = '/zhiyan/api/projects/my-projects'
axios.get(url)
```

**è¯·æ±‚æµç¨‹ï¼š**
```
æµè§ˆå™¨(localhost:8001)
  â†“ è¯·æ±‚: /zhiyan/api/projects/my-projects
Vueä»£ç†æœåŠ¡å™¨(8001)
  â†“ åŒ¹é…è§„åˆ™: /zhiyan/api/projects â†’ http://localhost:8095
  â†“ pathRewrite: ç§»é™¤ /zhiyan
  â†“ è½¬å‘: /api/projects/my-projects
é¡¹ç›®æœåŠ¡(8095)
  â†“ è¿”å›JSONæ•°æ®
æµè§ˆå™¨æ¥æ”¶
```

### 3. è®¤è¯APIè¯·æ±‚

**å‰ç«¯ä»£ç ï¼š**
```javascript
// zhiyan_front/src/api/auth.js
const url = '/zhiyan/api/auth/login'
axios.post(url, data)
```

**è¯·æ±‚æµç¨‹ï¼š**
```
æµè§ˆå™¨(localhost:8001)
  â†“ è¯·æ±‚: /zhiyan/api/auth/login
Vueä»£ç†æœåŠ¡å™¨(8001)
  â†“ åŒ¹é…è§„åˆ™: /zhiyan/api/auth â†’ http://localhost:8091
  â†“ pathRewrite: ç§»é™¤ /zhiyan
  â†“ è½¬å‘: /api/auth/login
è®¤è¯æœåŠ¡(8091)
  â†“ è¿”å›token
æµè§ˆå™¨æ¥æ”¶
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä»£ç†é¡ºåºå¾ˆé‡è¦**
   - æ›´å…·ä½“çš„è·¯å¾„è§„åˆ™å¿…é¡»æ”¾åœ¨å‰é¢
   - ä¾‹å¦‚ï¼š`/zhiyan/api/projects` å¿…é¡»åœ¨ `/zhiyan` ä¹‹å‰

2. **pathRewriteè§„åˆ™**
   - æœ‰äº›æœåŠ¡éœ€è¦ç§»é™¤`/zhiyan`å‰ç¼€ï¼ˆå¦‚é¡¹ç›®æœåŠ¡ã€è®¤è¯æœåŠ¡ï¼‰
   - æœ‰äº›æœåŠ¡ä¿ç•™å®Œæ•´è·¯å¾„ï¼ˆå¦‚çŸ¥è¯†åº“æˆæœï¼‰

3. **ä¸ä½¿ç”¨ç½‘å…³**
   - å½“å‰æ¶æ„ä¸­ï¼Œç½‘å…³(9006)æœªè¢«ä½¿ç”¨
   - æ‰€æœ‰è¯·æ±‚ç›´è¿åç«¯æœåŠ¡

4. **SSEæ”¯æŒ**
   - Dify AIä½¿ç”¨SSEï¼ˆServer-Sent Eventsï¼‰æµå¼ä¼ è¾“
   - éœ€è¦ä»£ç†é…ç½®æ”¯æŒWebSocketå’Œé•¿è¿æ¥ï¼š`ws: true`

## ğŸ§ª æµ‹è¯•æ£€æŸ¥æ¸…å•

### å¯åŠ¨æ‰€æœ‰æœåŠ¡

```bash
# 1. è®¤è¯æœåŠ¡ (8091)
cd zhiyan-auth && mvn spring-boot:run

# 2. çŸ¥è¯†åº“æœåŠ¡ (8093)
cd zhiyan-modules/zhiyan-knowledge && mvn spring-boot:run

# 3. Coze AI (8094)
cd zhiyan-ai/zhiyan-ai-coze && mvn spring-boot:run

# 4. é¡¹ç›®æœåŠ¡ (8095)
cd zhiyan-modules/zhiyan-project && mvn spring-boot:run

# 5. Dify AI (8097)
cd zhiyan-ai/zhiyan-ai-dify && mvn spring-boot:run

# 6. å‰ç«¯ (8001)
cd zhiyan_front && npm run serve
```

### æ£€æŸ¥ç«¯å£å ç”¨

```bash
netstat -ano | findstr "8091 8093 8094 8095 8097 8001"
```

**é¢„æœŸè¾“å‡ºï¼š**
```
TCP    0.0.0.0:8001    LISTENING    (å‰ç«¯)
TCP    0.0.0.0:8091    LISTENING    (è®¤è¯)
TCP    0.0.0.0:8093    LISTENING    (çŸ¥è¯†åº“)
TCP    0.0.0.0:8094    LISTENING    (Coze)
TCP    0.0.0.0:8095    LISTENING    (é¡¹ç›®)
TCP    0.0.0.0:8097    LISTENING    (Dify)
```

### æµ‹è¯•Difyå¯¹è¯

1. è®¿é—®ï¼šhttp://localhost:8001/
2. ç™»å½•ç³»ç»Ÿ
3. è¿›å…¥"AIå®éªŒåˆ†æåŠ©æ‰‹"
4. è¾“å…¥ï¼š"ä½ å¥½"
5. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼š

**é¢„æœŸæ—¥å¿—ï¼š**
```javascript
[Dify API] ç›´è¿DifyæœåŠ¡(8097)å‘é€è¯·æ±‚: {...}
[Dify API] è¯·æ±‚URL: /zhiyan/api/ai/chatflow/stream?query=ä½ å¥½
[Dify API] å“åº”çŠ¶æ€: 200 OK
[Dify API] æ”¶åˆ°æ•°æ®å— #1: ...
[AIåŠ©æ‰‹] æ”¶åˆ°Difyæ¶ˆæ¯ç‰‡æ®µ: ä½ 
[AIåŠ©æ‰‹] æ”¶åˆ°Difyæ¶ˆæ¯ç‰‡æ®µ: å¥½
...
```

## ğŸ“‹ æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼š404 Not Found

**åŸå› ï¼š** åç«¯æœåŠ¡æœªå¯åŠ¨æˆ–ç«¯å£é”™è¯¯

**è§£å†³ï¼š** æ£€æŸ¥å¯¹åº”ç«¯å£çš„æœåŠ¡æ˜¯å¦è¿è¡Œ

### é—®é¢˜2ï¼šCORSé”™è¯¯

**åŸå› ï¼š** åç«¯æœåŠ¡æœªé…ç½®CORS

**è§£å†³ï¼š** æ£€æŸ¥åç«¯æœåŠ¡çš„CORSé…ç½®

### é—®é¢˜3ï¼šä»£ç†ä¸ç”Ÿæ•ˆ

**åŸå› ï¼š** ä»£ç†è§„åˆ™é¡ºåºé”™è¯¯æˆ–pathRewriteé”™è¯¯

**è§£å†³ï¼š** æ£€æŸ¥vue.config.jsä¸­çš„ä»£ç†é…ç½®é¡ºåº

### é—®é¢˜4ï¼šDifyæµå¼å“åº”ä¸æ˜¾ç¤º

**åŸå› ï¼š** SSEè§£æé”™è¯¯æˆ–Vueå“åº”å¼æœªæ›´æ–°

**è§£å†³ï¼š** 
1. æ£€æŸ¥`dify.js`ä¸­çš„SSEè§£æé€»è¾‘
2. ç¡®ä¿ä½¿ç”¨`$set`æ›´æ–°Vueå“åº”å¼æ•°æ®

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**æ›´æ–°æ—¥æœŸï¼š** 2025-11-03  
**ç»´æŠ¤äººå‘˜ï¼š** å¼€å‘å›¢é˜Ÿ

