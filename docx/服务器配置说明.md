### 服务器内容

服务器1：
地址：10.7.10.159
用户名: ue
密码：rjxy@505

服务器2：
地址：10.7.10.98
用户名: xhyq
密码：rjxy@505

必须使用内网访问


### 健康检查
```bash
sudo systemctl status mysql

sudo systemctl status redis-server

sudo systemctl status nacos.service

sudo systemctl status minio

sudo systemctl status mongod
```


### 配置JDK21

确认版本

```bash
java -version
```

通过`apt`包管理器安装 OpenJDK 21。首先更新软件包列表，然后安装 OpenJDK 21：

```bash
sudo apt update
sudo apt install openjdk-21-jdk
```

通过配置环境变量来指定当前使用的 Java 版本。常见的环境变量是`PATH`和`JAVA_HOME`：

```bash
export PATH=/usr/lib/jvm/java-21-openjdk-amd64/bin:$PATH
export JAVA_HOME=/usr/lib/jvm/java-21-openjdk-amd64
```





### 配置 Mysql 8.0.25

在终端中输入以下命令，查看 MySQL 服务的状态：

```bash
sudo systemctl status mysql
```

如果 MySQL 已安装并正在运行，会显示 MySQL 服务的运行状态信息。

如果提示`Unit mysql.service could not be found.`，则表示系统中没有安装 MySQL。

如果 MySQL 已安装，输入以下命令查看 MySQL 的版本：

```bash
mysql --version
```

下载 MySQL 的官方 APT 仓库配置文件：

```bash
wget https://dev.mysql.com/get/mysql-apt-config_0.8.24-1_all.deb
```

然后，安装下载的 DEB 包：

```bash
sudo dpkg -i mysql-apt-config_0.8.24-1_all.deb
```

在安装过程中，会弹出一个配置窗口，选择 MySQL 8.0 版本。

接着，更新软件包列表并安装 MySQL 服务器：

```bash
sudo apt update
sudo apt install mysql-server
```

安装完成后，检查 MySQL 服务是否正常运行：

```bash
sudo systemctl status mysql
```

安装完成后，MySQL 会自动启动。可以使用以下命令进行安全配置，例如设置 root 密码等：

```bash
sudo mysql_secure_installation
```

设置为 root 用户的密码为 root

```mysql
-- 先切换到mysql系统数据库，因为用户信息存储在这个数据库中
USE mysql;

-- 更新root用户的密码，将localhost替换为你允许root用户登录的主机地址
-- 如果希望root用户能从任意主机登录，可以使用'%'，但存在安全风险
ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'root';

-- 刷新权限表，使修改立即生效
FLUSH PRIVILEGES;
```

在 MySQL 命令行界面中，执行以下命令退出：

```MYSQL
EXIT;
```

尝试使用新设置的密码登录 MySQL：

```BASH
mysql -u root -p
```

运行 MySQL 的安全配置脚本，进一步提升安全性：

```BASH
sudo mysql_secure_installation
```





### 配置 Redis 7.2.10

#### 步骤 1：安装依赖

首先安装编译所需的依赖包：

```bash
sudo apt update
sudo apt install -y build-essential tcl wget
```

#### 步骤 2：下载 Redis 7.2.10 源码

```bash
# 创建临时目录并进入
mkdir -p ~/redis-src && cd ~/redis-src

# 下载源码包
wget https://download.redis.io/releases/redis-7.2.10.tar.gz

# 解压
tar -zxvf redis-7.2.10.tar.gz
cd redis-7.2.10
```

#### 步骤 3：编译安装

```bash
# 编译
make

# 测试编译是否正常（可选但推荐）
make test

# 安装到系统目录
sudo make install
```

安装完成后，Redis 的可执行文件会被复制到`/usr/local/bin`目录下。

#### 步骤 4：配置 Redis

**创建配置文件和数据目录**：

```bash
# 创建配置文件目录
sudo mkdir -p /etc/redis

# 创建数据存储目录
sudo mkdir -p /var/lib/redis

# 创建日志目录
sudo mkdir -p /var/log/redis
```

**复制默认配置文件并修改**：

```bash
# 复制配置文件
sudo cp ~/redis-src/redis-7.2.10/redis.conf /etc/redis/

# 编辑配置文件
sudo nano /etc/redis/redis.conf
```

在配置文件中修改以下关键参数（按`Ctrl+W`搜索关键词）：

```conf
# 监听地址，默认只监听本地，如需远程访问改为0.0.0.0
bind 127.0.0.1 ::1

# 端口，默认6379（多人服务器建议修改为自定义端口避免冲突）
port 6379

# 数据存储目录
dir /var/lib/redis

# 日志文件路径
logfile /var/log/redis/redis-server.log

# 后台运行
daemonize yes

# 设置密码（重要：多人服务器必须设置）
requirepass your_secure_password

# 最大内存限制（根据服务器情况设置）
maxmemory 1gb
maxmemory-policy allkeys-lru
```

修改完成后按`Ctrl+O`保存，`Ctrl+X`退出。

#### 步骤 5：创建 Redis 专用用户与授权

为避免使用 root 用户运行 Redis 带来的安全风险，需创建专用系统用户并配置目录权限：

```bash
# 创建 redis 用户组（-r 表示系统组）
sudo groupadd -r redis

# 创建 redis 用户（-r 系统用户，-g 关联用户组，-d 指定家目录，-s 禁止登录）
sudo useradd -r -g redis -d /var/lib/redis -s /sbin/nologin redis

# 赋予目录权限（确保 redis 用户能读写数据、日志和配置）
sudo chown -R redis:redis /var/lib/redis  # 数据目录
sudo chown -R redis:redis /var/log/redis  # 日志目录
sudo chown -R redis:redis /etc/redis      # 配置目录
```

#### 步骤 6：创建 Systemd 服务（实现开机自启与管理）

手动创建 Systemd 服务文件，方便通过 `systemctl` 管理 Redis 服务：

```bash
# 创建服务文件
sudo nano /etc/systemd/system/redis.service
```

将以下内容粘贴到文件中（确保路径与实际配置一致）：

```ini
[Unit]
Description=Redis In-Memory Data Store  # 服务描述
After=network.target                    # 网络启动后再启动 Redis

[Service]
User=redis                              # 运行用户
Group=redis                             # 运行用户组
ExecStart=/usr/local/bin/redis-server /etc/redis/redis.conf  # 启动命令（指定配置文件）
ExecStop=/usr/local/bin/redis-cli -a your_secure_password shutdown  # 停止命令（需替换为实际密码）
Restart=on-failure                      # 失败时自动重启（避免无限重启）
LimitNOFILE=65536                       # 提高文件描述符限制（应对高并发）
RuntimeDirectory=redis                  # 自动创建临时运行目录
RuntimeDirectoryMode=0755               # 临时目录权限

[Install]
WantedBy=multi-user.target  # 多用户模式下开机自启
```

- 注意：将 `your_secure_password` 替换为步骤 4 中设置的 Redis 密码；若未设置密码，删除 `-a your_secure_password` 部分。

#### 步骤 7：加载服务并测试启动

```bash
# 重新加载 Systemd 配置（使新服务生效）
sudo systemctl daemon-reload

# 启动 Redis 服务
sudo systemctl start redis

# 设置开机自启
sudo systemctl enable redis

# 查看服务状态（确保显示 active (running)）
sudo systemctl status redis-server
```

- 若状态显示 `active (running)`，说明服务启动成功；若失败，通过 `sudo journalctl -u redis -f` 查看详细错误日志。

#### 步骤 8：验证 Redis 功能

通过 `redis-cli` 测试连接与核心功能：

```bash
# 1. 使用密码连接（替换为实际密码）
redis-cli -a your_secure_password

# 2. 测试基础命令（成功会返回对应结果）
ping          # 返回 PONG（表示连接正常）
set test_key "hello_redis"  # 返回 OK（设置键值对）
get test_key  # 返回 "hello_redis"（获取键值）
exit          # 退出客户端
```

- 若连接失败，检查：① Redis 服务是否正常运行；② 密码是否正确；③ 配置文件中 `bind` 地址是否允许当前机器访问（如远程访问需设为 `bind 0.0.0.0`）。

#### 步骤 9：常见维护操作（可选）

1. **重启 Redis**：

   ```bash
   sudo systemctl restart redis
   ```

2. **停止 Redis**：

   ```bash
   sudo systemctl stop redis
   ```

3. **查看 Redis 日志**（排查问题用）：

   ```bash
   sudo tail -n 50 /var/log/redis/redis-server.log
   ```

4. **修改配置后生效**：

   修改 `/etc/redis/redis.conf` 后，需重启服务使配置生效：

   ```bash
   sudo systemctl restart redis
   ```



### 配置Nacos

首先 java 和 Mysql 需要配置好，JDK需要大于18

从 Nacos 的官方下载页面（https://github.com/alibaba/nacos/releases）下载最新版本的 Nacos 安装包，例如 `nacos-server-2.5.1.tar.gz`。

解压安装包

```bash
tar -zxvf nacos-server-3.1.0.tar.gz
```

解压完成后，你会看到一个名为 `nacos` 的文件夹。

如果需要使用 MySQL 数据库，进入 `conf` 目录，编辑 `application.properties` 文件：

```
cd nacos/conf
nano application.properties
```

在文件中添加以下内容

```bash
# 数据源平台设置为mysql
spring.datasource.platform=mysql
# 数据库实例数量
db.num=1
# 你的MySQL连接URL，注意数据库名、时区等参数
db.url.0=jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&connectTimeout=1000&socketTimeout=3000&autoReconnect=true&useSSL=false&serverTimezone=UTC
# 你的数据库用户名
db.user.0=your_username
# 你的数据库密码
db.password.0=your_password
```

修改完成后按`Ctrl+O`保存，`Ctrl+X`退出。

登录到 MySQL 数据库并创建一个名为 `nacos` 的数据库：

```bash
mysql -u root -p
```

输入密码后，执行以下 SQL 命令

```bash
CREATE DATABASE nacos CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 1. 若用户 'root'@'%' 不存在，先创建并设置密码
CREATE USER IF NOT EXISTS 'root'@'%' IDENTIFIED BY 'root';

-- 2. 若用户已存在，仅更新密码（可选，若密码已正确可跳过）
ALTER USER 'root'@'%' IDENTIFIED BY 'root';

-- 授予 root 用户对 nacos 数据库所有表的全部权限，允许远程访问
GRANT ALL PRIVILEGES ON nacos.* TO 'root'@'%' IDENTIFIED BY 'your_password';
FLUSH PRIVILEGES;
EXIT;
```

在 `/opt/nacos/conf` 目录下运行以下命令初始化数据库

```bash
mysql -u root -p nacos < mysql-schema.sql
```

确认存在表nacos

```mysql

```

进入 Nacos 的 `bin` 目录

```bash
cd /home/xhyq/ZhiyanPlatform/Nacos/nacos/bin/
```

以单机模式启动 Nacos

```bash
bash startup.sh -m standalone
```

然后配置初始密钥

在 Linux 终端中执行以下命令，直接生成符合要求的 Base64 密钥（无需手动拼接字符串）

```bash
# 生成一个 48 位的随机字符串（满足 ≥32 位要求），并进行 Base64 编码
openssl rand -hex 24 | base64
```

例如：ZjJjMjBmZmQwNzM3OWYwYzYyZTdiNDBlZjk5ZmViZjcxMjcwMTZkNTEzYmFlZTc3Cg==

启动完成后，可以通过查看日志文件确认 Nacos 是否正常运行：

```bash
cat /home/xhyq/ZhiyanPlatform/Nacos/nacos/logs/startup.log
```

```bash
tail -f /home/xhyq/ZhiyanPlatform/Nacos/nacos/logs/startup.log
```

关闭Naos
```bash
sh shutdown.sh
```

Nacos 默认运行在 `8848` 端口上。在浏览器中输入以下地址访问 Nacos 控制台：

```bash
http://localhost:8848/nacos
```

如果没有开启鉴权，页面会直接显示 Nacos 控制台。如果开启了鉴权，需要使用默认账号 `nacos` 和密码 `nacos` 登录。

为了确保 Nacos 在系统启动时自动运行，我们需要将其配置为服务。

创建一个名为 `nacos.service` 的 systemd 服务文件：

```bash
sudo nano /etc/systemd/system/nacos.service
```

在文件中添加以下内容：

```bash
[Unit]
Description=Nacos Service
After=network.target

[Service]
Type=forking
ExecStart=/bin/bash /opt/nacos/bin/startup.sh -m standalone
ExecStop=/bin/bash /opt/nacos/bin/shutdown.sh
User=root
Restart=on-failure

[Install]
WantedBy=multi-user.target
```

重新加载 systemd 配置

````bash
sudo systemctl daemon-reload
````

启用服务配置

```bash
sudo systemctl enable nacos.service
```

启动服务

```bash
sudo systemctl start nacos.service
```

检查服务状态

```bash
sudo systemctl status nacos.service
```

如果需要关闭 Nacos，可以在 `bin` 目录下执行以下命令：

```bash
bash shutdown.sh
```

### 配置MinIO

重载并启动服务
```bash
sudo systemctl daemon-reload    # 重新刷新系统服务
sudo systemctl enable minio     # 设置开机自启动
sudo systemctl start minio      # 启动服务
sudo systemctl status minio     # 查看MinIO状态，输出应显示 active (running)。
journalctl -u minio.service -f    # 查看实时日志
```