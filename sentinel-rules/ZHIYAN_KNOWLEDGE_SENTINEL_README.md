# æ™ºç ”å¹³å°çŸ¥è¯†åº“æ¨¡å— Sentinel é…ç½®è¯´æ˜

## ğŸ“‹ é…ç½®æ–‡ä»¶è¯´æ˜

çŸ¥è¯†åº“æ¨¡å—å·²ç»é›†æˆäº† Sentinel æµæ§é™çº§åŠŸèƒ½ï¼Œå…±æœ‰ä¸‰ä¸ªè§„åˆ™é…ç½®æ–‡ä»¶ï¼š

### 1. zhiyan-knowledge-flow-rules.json - æµæ§è§„åˆ™

é’ˆå¯¹é«˜è®¿é—®é‡æ¥å£çš„ QPS é™æµé…ç½®ï¼š

| èµ„æºåç§° | æ¥å£è¯´æ˜ | QPSé™åˆ¶ | é€‚ç”¨åœºæ™¯ |
|---------|---------|--------|---------|
| `knowledge:achievement:query` | åˆ†é¡µæŸ¥è¯¢æˆæœåˆ—è¡¨ | 100 | å¤æ‚æ¡ä»¶æŸ¥è¯¢ |
| `knowledge:achievement:queryByProject` | æ ¹æ®é¡¹ç›®IDæŸ¥è¯¢æˆæœ | 150 | å¸¸ç”¨æŸ¥è¯¢æ¥å£ |
| `knowledge:achievement:search` | å…³é”®å­—æœç´¢æˆæœ | 200 | æœç´¢åŠŸèƒ½ |
| `knowledge:file:upload` | å•æ–‡ä»¶ä¸Šä¼  | 10 | é˜²æ­¢é¢‘ç¹ä¸Šä¼  |
| `knowledge:file:uploadBatch` | æ‰¹é‡æ–‡ä»¶ä¸Šä¼  | 5 | èµ„æºå¯†é›†å‹æ“ä½œ |
| `knowledge:ai:getFileById` | AIè·å–å•ä¸ªæ–‡ä»¶ | 100 | AIè°ƒç”¨æ¥å£ |
| `knowledge:ai:getFilesBatch` | AIæ‰¹é‡è·å–æ–‡ä»¶ | 50 | AIæ‰¹é‡è°ƒç”¨ |
| `knowledge:ai:getFileUrl` | è·å–æ–‡ä»¶ä¸‹è½½URL | 80 | æ–‡ä»¶ä¸‹è½½ |
| `knowledge:statistics:project` | é¡¹ç›®æˆæœç»Ÿè®¡ | 50 | ç»Ÿè®¡æŸ¥è¯¢ |
| `knowledge:statistics:status` | æŒ‰çŠ¶æ€ç»Ÿè®¡ | 50 | ç»Ÿè®¡æŸ¥è¯¢ |
| `knowledge:statistics:type` | æŒ‰ç±»å‹ç»Ÿè®¡ | 50 | ç»Ÿè®¡æŸ¥è¯¢ |

### 2. zhiyan-knowledge-degrade-rules.json - ç†”æ–­é™çº§è§„åˆ™

é’ˆå¯¹å®¹æ˜“è¶…æ—¶å’Œä¾èµ–å¤–éƒ¨æœåŠ¡çš„æ¥å£ï¼š

| èµ„æºåç§° | é™çº§ç­–ç•¥ | é˜ˆå€¼ | ç†”æ–­æ—¶é•¿ | è¯´æ˜ |
|---------|---------|------|---------|------|
| `knowledge:file:upload` | æ…¢è°ƒç”¨æ¯”ä¾‹ | RT>3s, æ¯”ä¾‹>60% | 30ç§’ | æ–‡ä»¶ä¸Šä¼ æ…¢è°ƒç”¨ä¿æŠ¤ |
| `knowledge:file:uploadBatch` | æ…¢è°ƒç”¨æ¯”ä¾‹ | RT>5s, æ¯”ä¾‹>50% | 60ç§’ | æ‰¹é‡ä¸Šä¼ æ…¢è°ƒç”¨ä¿æŠ¤ |
| `knowledge:ai:getFileById` | å¼‚å¸¸æ¯”ä¾‹ | å¼‚å¸¸>30% | 30ç§’ | AIæœåŠ¡å¼‚å¸¸ä¿æŠ¤ |
| `knowledge:ai:getFilesBatch` | å¼‚å¸¸æ¯”ä¾‹ | å¼‚å¸¸>40% | 30ç§’ | AIæ‰¹é‡è°ƒç”¨å¼‚å¸¸ä¿æŠ¤ |
| `knowledge:statistics:project` | æ…¢è°ƒç”¨æ¯”ä¾‹ | RT>2s, æ¯”ä¾‹>50% | 20ç§’ | ç»Ÿè®¡æŸ¥è¯¢æ…¢è°ƒç”¨ä¿æŠ¤ |
| `knowledge:statistics:status` | æ…¢è°ƒç”¨æ¯”ä¾‹ | RT>1.5s, æ¯”ä¾‹>50% | 20ç§’ | ç»Ÿè®¡æŸ¥è¯¢æ…¢è°ƒç”¨ä¿æŠ¤ |
| `knowledge:statistics:type` | æ…¢è°ƒç”¨æ¯”ä¾‹ | RT>1.5s, æ¯”ä¾‹>50% | 20ç§’ | ç»Ÿè®¡æŸ¥è¯¢æ…¢è°ƒç”¨ä¿æŠ¤ |
| `knowledge:achievement:search` | æ…¢è°ƒç”¨æ¯”ä¾‹ | RT>2s, æ¯”ä¾‹>60% | 15ç§’ | æœç´¢æ…¢è°ƒç”¨ä¿æŠ¤ |

**é™çº§ç­–ç•¥è¯´æ˜ï¼š**
- **grade=0**ï¼šæ…¢è°ƒç”¨æ¯”ä¾‹ç­–ç•¥
- **grade=1**ï¼šå¼‚å¸¸æ¯”ä¾‹ç­–ç•¥
- **grade=2**ï¼šå¼‚å¸¸æ•°ç­–ç•¥

### 3. zhiyan-knowledge-system-rules.json - ç³»ç»Ÿä¿æŠ¤è§„åˆ™

å…¨å±€ç³»ç»Ÿä¿æŠ¤é…ç½®ï¼š

- **CPUä½¿ç”¨ç‡**ï¼š85%
- **ç³»ç»Ÿè´Ÿè½½**ï¼š3.0
- **å¹³å‡å“åº”æ—¶é—´**ï¼š3000ms
- **æœ€å¤§çº¿ç¨‹æ•°**ï¼š200

## ğŸš€ å·²æ·»åŠ  Sentinel ä¿æŠ¤çš„æ¥å£

### æœç´¢æ¥å£ï¼ˆé«˜è®¿é—®é‡ï¼‰
- âœ… `POST /zhiyan/achievement/search/query` - åˆ†é¡µæŸ¥è¯¢æˆæœ
- âœ… `GET /zhiyan/achievement/search/project/{projectId}` - æ ¹æ®é¡¹ç›®IDæŸ¥è¯¢
- âœ… `GET /zhiyan/achievement/search/search` - å…³é”®å­—æœç´¢

### æ–‡ä»¶ä¸Šä¼ æ¥å£ï¼ˆå®¹æ˜“è¶…æ—¶ï¼‰
- âœ… `POST /zhiyan/achievement/file/upload` - å•æ–‡ä»¶ä¸Šä¼ 
- âœ… `POST /zhiyan/achievement/file/upload/batch` - æ‰¹é‡æ–‡ä»¶ä¸Šä¼ 

### AIæ¥å£ï¼ˆä¾èµ–å¤–éƒ¨æœåŠ¡ï¼‰
- âœ… `GET /api/knowledge/files/{fileId}` - è·å–å•ä¸ªæ–‡ä»¶ä¿¡æ¯
- âœ… `GET /api/knowledge/files/batch` - æ‰¹é‡è·å–æ–‡ä»¶ä¿¡æ¯
- âœ… `GET /api/knowledge/files/{fileId}/url` - è·å–æ–‡ä»¶ä¸‹è½½URL

### ç»Ÿè®¡æ¥å£ï¼ˆå¤æ‚æŸ¥è¯¢ï¼‰
- âœ… `GET /zhiyan/achievement/statistics/project/{projectId}` - é¡¹ç›®æˆæœç»Ÿè®¡
- âœ… `GET /zhiyan/achievement/statistics/status/{projectId}` - æŒ‰çŠ¶æ€ç»Ÿè®¡
- âœ… `GET /zhiyan/achievement/statistics/type/{projectId}` - æŒ‰ç±»å‹ç»Ÿè®¡

## ğŸ“Š ä½¿ç”¨æ–¹æ³•

### 1. æŸ¥çœ‹å®æ—¶ç›‘æ§

è®¿é—® Sentinel Dashboardï¼š
- **å¼€å‘ç¯å¢ƒ**: http://localhost:8858
- **ç”Ÿäº§ç¯å¢ƒ**: http://10.7.10.98:8858
- **è´¦å·å¯†ç **: sentinel / sentinel

### 2. å¯¼å…¥è§„åˆ™åˆ° Nacos

åœ¨ Nacos é…ç½®ä¸­å¿ƒåˆ›å»ºä»¥ä¸‹é…ç½®ï¼š

#### æµæ§è§„åˆ™
- **Data ID**: `zhiyan-knowledge-flow-rules.json`
- **Group**: `SENTINEL_GROUP`
- **é…ç½®å†…å®¹**: å¤åˆ¶ `zhiyan-knowledge-flow-rules.json` çš„å†…å®¹

#### é™çº§è§„åˆ™
- **Data ID**: `zhiyan-knowledge-degrade-rules.json`
- **Group**: `SENTINEL_GROUP`
- **é…ç½®å†…å®¹**: å¤åˆ¶ `zhiyan-knowledge-degrade-rules.json` çš„å†…å®¹

#### ç³»ç»Ÿè§„åˆ™
- **Data ID**: `zhiyan-knowledge-system-rules.json`
- **Group**: `SENTINEL_GROUP`
- **é…ç½®å†…å®¹**: å¤åˆ¶ `zhiyan-knowledge-system-rules.json` çš„å†…å®¹

### 3. åŠ¨æ€è°ƒæ•´è§„åˆ™

è§„åˆ™å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åŠ¨æ€è°ƒæ•´ï¼š

1. **åœ¨ Dashboard ä¸­è°ƒæ•´**ï¼ˆä¸´æ—¶ç”Ÿæ•ˆï¼Œé‡å¯å¤±æ•ˆï¼‰
   - è®¿é—® Dashboard
   - é€‰æ‹© `zhiyan-knowledge` æœåŠ¡
   - åœ¨ã€Œæµæ§è§„åˆ™ã€æˆ–ã€Œé™çº§è§„åˆ™ã€ä¸­ä¿®æ”¹

2. **åœ¨ Nacos ä¸­è°ƒæ•´**ï¼ˆæŒä¹…åŒ–ï¼Œæ¨èï¼‰
   - ç™»å½• Nacos æ§åˆ¶å°
   - æ‰¾åˆ°å¯¹åº”çš„é…ç½®
   - ä¿®æ”¹å¹¶å‘å¸ƒ
   - è§„åˆ™ä¼šè‡ªåŠ¨æ¨é€åˆ°æœåŠ¡

## ğŸ¯ é™æµå“åº”ç¤ºä¾‹

å½“æ¥å£è¢«é™æµæ—¶ï¼Œè¿”å›ç»Ÿä¸€çš„å“åº”æ ¼å¼ï¼š

```json
{
  "code": 429,
  "message": "æŸ¥è¯¢è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•",
  "data": null,
  "timestamp": 1699999999999
}
```

å½“æœåŠ¡é™çº§æ—¶ï¼Œè¿”å›ï¼š

```json
{
  "code": 503,
  "message": "æ–‡ä»¶ä¸Šä¼ æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•",
  "data": null,
  "timestamp": 1699999999999
}
```

## ğŸ“ è§„åˆ™è°ƒä¼˜å»ºè®®

### æ ¹æ®å®é™…ä¸šåŠ¡è°ƒæ•´ QPS

è§‚å¯Ÿ Dashboard ä¸­çš„å®æ—¶ QPSï¼Œæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼š

```json
{
  "resource": "knowledge:achievement:search",
  "count": 200  // æ ¹æ®å®é™…æƒ…å†µè°ƒå¤§æˆ–è°ƒå°
}
```

### è°ƒæ•´ç†”æ–­é˜ˆå€¼

å¦‚æœå‘ç°è¯¯è§¦å‘ç†”æ–­ï¼Œå¯ä»¥è°ƒæ•´é˜ˆå€¼ï¼š

```json
{
  "resource": "knowledge:file:upload",
  "count": 3.0,  // æ…¢è°ƒç”¨RTé˜ˆå€¼ï¼ˆç§’ï¼‰
  "slowRatioThreshold": 0.6,  // æ…¢è°ƒç”¨æ¯”ä¾‹é˜ˆå€¼
  "minRequestAmount": 5  // æœ€å°è¯·æ±‚æ•°
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **é¦–æ¬¡å¯åŠ¨**ï¼šæœåŠ¡å¯åŠ¨åè‡³å°‘è°ƒç”¨ä¸€æ¬¡æ¥å£ï¼Œæ‰ä¼šåœ¨ Dashboard ä¸­æ˜¾ç¤º
2. **ç«¯å£é…ç½®**ï¼šçŸ¥è¯†åº“æ¨¡å—ä½¿ç”¨ `8724` ç«¯å£ä¸ Sentinel é€šä¿¡
3. **è§„åˆ™æŒä¹…åŒ–**ï¼šåŠ¡å¿…å°†è§„åˆ™é…ç½®åˆ° Nacosï¼Œå¦åˆ™é‡å¯åå¤±æ•ˆ
4. **æ€§èƒ½å½±å“**ï¼šSentinel æ€§èƒ½æŸè€—æå°ï¼ˆçº¦0.1msï¼‰ï¼Œå¯æ”¾å¿ƒä½¿ç”¨

## ğŸ”§ å¸¸è§é—®é¢˜

### Dashboard çœ‹ä¸åˆ°æœåŠ¡ï¼Ÿ
- ç¡®ä¿é…ç½®æ­£ç¡®ï¼š`zhiyan.sentinel.dashboard.host` å’Œ `port`
- è‡³å°‘è°ƒç”¨ä¸€æ¬¡æ¥å£è§¦å‘ Sentinel
- æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™

### è§„åˆ™ä¸ç”Ÿæ•ˆï¼Ÿ
- æ£€æŸ¥èµ„æºåç§°æ˜¯å¦æ­£ç¡®ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
- åœ¨ Dashboard çš„ã€Œç°‡ç‚¹é“¾è·¯ã€ä¸­ç¡®è®¤èµ„æºæ˜¯å¦å­˜åœ¨
- æŸ¥çœ‹æœåŠ¡æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯

### å¦‚ä½•æµ‹è¯•é™æµï¼Ÿ
ä½¿ç”¨å‹æµ‹å·¥å…·ï¼ˆå¦‚ JMeterã€Apache Benchï¼‰æ¨¡æ‹Ÿé«˜å¹¶å‘è¯·æ±‚ï¼š

```bash
# ä½¿ç”¨ Apache Bench æµ‹è¯•
ab -n 1000 -c 50 http://localhost:8094/zhiyan/achievement/search/search?keyword=æµ‹è¯•
```

---

**æ›´æ–°æ—¶é—´**: 2025-11-05  
**ç‰ˆæœ¬**: v1.0.0

